# TDD & Unit Test

## TDD
테스트 주도 개발(Test-driven devlopment, TDD)은 소프트웨어 개발 방법론 중의 하나로, 선 개발 후 테스트 방식이 아닌 선 테스트 후 개발 방식의 프로그래밍 방법을 말한다.
- 먼저 자동화된 테스트 코드를 작성한 후 테스트를 통과하기 위한 코드를 개발하는 방식

### 장점
1. 객체 지향적인 코드 개발
    -  TDD는 코드의 재사용 보장을 명시하므로 TDD를 통한 개발 시 기능별로 모듈화가 이루어진다.
    - 의존성과 종속성이 낮은 모듈로 조합된 소프트웨어 개발을 가능하게 하며, 필요에 따라 모듈을 추가하거나 제거해도 소프트웨어 전체 구조에 영향을 미치지 않게 된다.

2. 설계 수정시간의 단축
    - 테스트코드를 먼저 작성하기 때문에 최초 설계안을 만족하게 하며 입출력 구조와 기능의 정의를 명확하게 되므로 설계의 구조적 문제를 바로 찾아낼 수 있다.

3. 유지보수의 용이성
    - 기본적으로 단위 테스트 기반의 테스트 코드를 작성하기 때문에 추후 문제가 발생하였을 때 각각의 모듈별로 테스트를 진행해보면 문제의 지점을 쉽게 찾을 수 있다.

4. 테스트 문서의 대체 가능
    - 대부분의 개발 프로젝트에서 테스트를 진행하는 경우 단순 통합 테스트에 지나지 않는다. TDD를 하게 될 때 테스팅을 자동화시킴과 동시에 더욱 정확한 테스트 근거를 산출해 정의서를 작성할 수 있다.

### 단점
1. 사전준비 기간
    - TDD를 프로젝트에 도입하려면 사전에 필요한 지식을 습득하고 개발 환경을 구축해야 한다. TDD를 효과적으로 사용할 수 있는 수준으로 개발자를 교육하는 데 보통 1~6개월간의 시간이 필요하다.

2. 생산성 저하
    - 프로젝트를 진행할 때 경험 때문에 어떤 예외상황이 발생할지 눈에 뻔히 보이는 경우가 종종 있다. 이러한 단발성 개발은 개발 기간이 타이트하게 잡히는 경우가 많은데, 이럴 때 TDD를 이용해 테스트 코드를 작성하고 그에 통과하기 위한 코드를 작성한다면 비효율적일 것이다.

### TDD 결론
- TDD를 활용하면 테스트 케이스를 설계하기 위한 초기 비용이 들어가게 되지만 이러한 초기 비용보다 유지보수 비용이 더 클 수가 있다.
- 하지만 테스트에만 너무 과도하게 몰입해버린다면 시간 낭비가 될 수 있다. 프로젝트의 경험 때문에 어떤 예외상황이 발생할지, 어떤 결과가 발생할지 쉽게 파악된다면 TDD를 하지 않아도 된다.


## Unit Test

실무에서 테스트 코드를 작성한다고 하면  대부분 단위 테스트를 의미한다. 

단위 테스트(Unit Test)는 하나의 모듈을 기준으로 독립적으로 진행되는 가장 작은 단위의 테스트이다. 여기서 모듈은 애플리케이션에서 작동하는 하나의 기능 또는 메소드로 이해할 수 있다. 
- Ex) 웹 애플리케이션에서 로그인 메소드에 대한 독립적인 테스트
- 애플리케이션을 구성하는 하나의 기능이 올바르게 동작하는지를 독립적을 테스트하는 것으로, "어떤 기능이 실행되면 어떤 결과가 나온다" 정도로 테스트를 진행한다.

### 단위 테스트 작성의 필요성

통합 테스트는 실제 여러 컴포넌트들 간의 상호작용을 테스트하기 때문에 모든 컴포넌트들이 구동된 상태에서 테스트를 하게 된다. 그렇기 때문에 통합 테스트를 위해서는 캐시나 데이터베이스 등 다른 컴포넌트들과 실제 연결을 해야 하고, 시스템을 구성하는 컴포넌트들이 많아질수록 테스트를 위한 비용(시간)이 상당히 커진다.

반면에 단위 테스트는 해당 부분만 독립적으로 테스트하기 때문에 어떤 코드를 리팩토링하여도 빠르게 문제 여부를 확인할 수 있다.

- 테스팅에 대한 시간 및 비용 절감
- 새로운 기능 추가 시에 수시로 빠르게 테스트 가능
- 리팩토링 시 안정성 확보
- 코드에 대한 문서가 될 수 있다.

우리는 우리가 작성한 테스트 코드를 수시로 빠르게 돌리면서 문제를 파악할 수 있다.

### 단위 테스트 문제점
어떤 객체가 자체적으로 모든 일을 처리한다면 문제가 없지만 대부분의 애플리케이션에서는 1개의 기능을 처리하기 위해 다른 객체들과 메시지를 주고 받아야 한다. 단위 테스트는 해당 모듈에 대한 독립적인 테스트이기 때문에 다른 객체와 메시지를 주고 받는 경우에 문제가 발생한다.

그렇기 때문에 다른 객체 대신에 가짜 객체(Mock Object)를 주입하여 어떤 결과를 반환하려고 정해진 답변을 준비시켜야 하는데, 이를 stub이라고 한다.
- 데이터베이스에서 새로운 데이터를 추가하는 코드를 테스트한다고 하면, 가짜 데이터베이스(Mock Database)를 주입하여 insert 처리 시에 반드시 1을 반환해도록 해주는 것이 stub

### 좋은 단위 테스트 특징
일반적으로 요구 사항은 계속해서 변하고, 그에 맞춰 우리의 코드 역시 변경되어야 한다. 하지만 실제 코드를 변경한다는 것은 잠재적인 버그가 발생할 수 있음을 내포하는데, 좋은 테스트 코드가 있다면 변경된 코드를 검증함으로써 이를 해결할 수 있다. 또한 실제 코드가 변경되면 테스트 코드 역시 변경이 필요할 수 있는데, 이러한 이유로 우리는 테스트 코드 역시 가독성있게 작성할 필요가 있다.

그렇기에 테스트를 작성하는 경우에는 다음을 준수하는 것이 좋다.

- 1개의 테스트 함수에 대해 assert를 최소화하라
- 1개의 테스트 함수는 1가지 개념 만을 테스트하라

또한 요즘 읽고 있는 Clean Code에서 FIRST라는 5가지 규칙을 알려주었다.

- Fast: 테스트는 빠르게 동작하여 자주 돌릴 수 있어야 한다.
- Independent: 각각의 테스트는 독립적이며 서로 의존해서는 안된다.
- Repeatable: 어느 환경에서도 반복 가능해야 한다.
- Self-Validating: 테스트는 성공 또는 실패로 bool 값으로 결과를 내어 자체적으로 검증되어야 한다.
- Timely: 테스트는 적시에 즉, 테스트하려는 실제 코드를 구현하기 직전에 구현해야 한다.


### 느낀점
회사에서 진행하고 있는 프로젝트의 MVP와 사이드 프로젝트가 거의 끝나가게 되고 나의 코드를 되돌아 보니 너무나도 깔끔하지 않다라는 것을 느꼈었고 리팩토링을 위해서 저번주부터 Clean Code 책을 읽으면서 깨끗한 코드를 짜는 방법에 대해 익히고 있었다. 

그렇게 리팩토링을 하다보니 코드가 조금 꼬이게 되어서 다시 테스트를 진행해야하는 상황이 발생하였지만 내가 개발할 때 단위 테스트를 대부분 작성하지 않으면서 개발을 진행하였기 때문에 기능이 추가되거나 리팩토링한 코드들에 대해서 테스트를 다시 하는 것에 어려움이 생기게 되었고 다시금 TDD 방법론의 중요성을 알게 되었다...

오늘 이후로는 개발을 할때 단위 테스트를 작성하면서 작업을 하고 다시 개발한 것들에 대해 빠르게 검증받으면서 프로젝트를 진행할 것이다.



### 참조
- http://www.incodom.kr/%ED%85%8C%EC%8A%A4%ED%8A%B8_%EC%A3%BC%EB%8F%84_%EA%B0%9C%EB%B0%9C
- https://mangkyu.tistory.com/143